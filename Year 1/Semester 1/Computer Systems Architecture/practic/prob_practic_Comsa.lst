     1                                  bits 32
     2                                  global start
     3                                  
     4                                  extern exit, fopen, fread, fclose, printf, fprintf
     5                                  import exit msvcrt.dll
     6                                  import fopen msvcrt.dll
     7                                  import fread msvcrt.dll
     8                                  import fclose msvcrt.dll
     9                                  import printf msvcrt.dll
    10                                  import fprintf msvcrt.dll
    11                                  
    12                                  segment data use32 class=data
    13 00000000 70726F625F436F6D73-         file_name db "prob_Comsa.txt", 0
    13 00000009 612E74787400       
    14 0000000F 7200                        access_mode db "r", 0
    15 00000011 FFFFFFFF                    file_descriptor dd -1
    16 00000015 257300                      format db "%s", 0
    17                                      
    18 00000018 <res 000000C8>              text resb 200
    19                                      len equ 200
    20 000000E0 00<rept>                    nr times len db 0
    21 000001A8 00<rept>                    sir times (len + 1) db 0
    22 00000271 <res 00000032>              output resb 50
    23 000002A3 7700                        access_mode_out db "w", 0
    24                                      
    25                                  segment code use32 class=code
    26                                  start:
    27 00000000 68[0F000000]                push dword access_mode
    28 00000005 68[00000000]                push dword file_name
    29 0000000A FF15[00000000]              call [fopen]
    30                                      
    31 00000010 A3[11000000]                mov [file_descriptor], eax
    32 00000015 83F800                      cmp eax, 0
    33 00000018 0F840A010000                je final
    34                                          
    35 0000001E FF35[11000000]                  push dword [file_descriptor]
    36 00000024 68C8000000                      push dword len
    37 00000029 6A01                            push dword 1
    38 0000002B 68[18000000]                    push dword text
    39 00000030 FF15[00000000]                  call [fread]
    40 00000036 83C410                          add esp, 4 * 4
    41                                          
    42 00000039 FF35[11000000]                  push dword [file_descriptor]
    43 0000003F FF15[00000000]                  call [fclose]
    44 00000045 83C404                          add esp, 4
    45                                          
    46 00000048 BF01000000                      mov edi, 1 ; sa vad daca sunt pe o linie para/impara
    47 0000004D BE00000000                      mov esi, 0 ; merg prin text
    48 00000052 B900000000                      mov ecx, 0 ; linia pe care o scriu
    49 00000057 B600                            mov dh, 0  ; cuv nou
    50 00000059 BB00000000                      mov ebx, 0
    51                                          Repeta:
    52 0000005E 8A96[18000000]                      mov dl, [text + esi] ; caracterul curent
    53                                              
    54 00000064 80FA0A                              cmp dl, 10
    55 00000067 7567                                jnz nu_e_rand_nou
    56 00000069 F7C701000000                            test edi, 1
    57 0000006F 753F                                    jnz impar
    58 00000071 C681[A8010000]00                            mov [sir + ecx], byte 0
    59                                                      
    60 00000078 60                                          pushad
    61                                                      
    62 00000079 68[A3020000]                                push dword access_mode_out
    63 0000007E 68[71020000]                                push dword output
    64 00000083 FF15[00000000]                              call [fopen]
    65 00000089 83C408                                      add esp, 4 * 2
    66                                                      
    67 0000008C 68[A8010000]                                push dword sir
    68 00000091 FF35[11000000]                              push dword [file_descriptor]
    69 00000097 FF15[00000000]                              call [fprintf]
    70 0000009D 83C408                                      add esp, 4 * 2
    71                                              
    72 000000A0 FF35[11000000]                              push dword [file_descriptor]
    73 000000A6 FF15[00000000]                              call [fclose]
    74 000000AC 83C404                                      add esp, 4
    75                                                      
    76 000000AF 61                                          popad
    77                                                      
    78                                                  impar:
    79                                              
    80 000000B0 47                                      inc edi
    81 000000B1 B600                                    mov dh, 0
    82                                                  
    83 000000B3 F7C701000000                            test edi, 1
    84 000000B9 7505                                    jnz impar1
    85 000000BB B900000000                                  mov ecx, 0
    86                                                  
    87                                                  impar1:
    88                                                  
    89 000000C0 F7C701000000                            test edi, 1
    90 000000C6 7405                                    jz par1
    91 000000C8 BB00000000                                  mov ebx, 0
    92                                                      
    93                                                  par1:
    94                                                  
    95 000000CD 46                                      inc esi
    96 000000CE EB8E                                    jmp Repeta
    97                                                  
    98                                              nu_e_rand_nou:
    99                                              
   100 000000D0 F7C701000000                        test edi, 1
   101 000000D6 7507                                jnz impar2
   102 000000D8 8891[A8010000]                          mov [sir + ecx], dl
   103 000000DE 41                                      inc ecx
   104                                                  
   105                                              impar2:
   106                                              
   107 000000DF F7C701000000                        test edi, 1
   108 000000E5 743B                                jz par2
   109 000000E7 80FA20                                  cmp dl, ' '
   110 000000EA 752A                                    jnz nu_e_cuv_nou1
   111 000000EC FEC6                                        inc dh
   112 000000EE 80FE01                                      cmp dh, 1
   113 000000F1 7523                                        jnz nu_txt
   114 000000F3 C683[71020000]2E                                mov [output + ebx], byte '.'
   115 000000FA C683[72020000]74                                mov [output + ebx + 1], byte 't'
   116 00000101 C683[73020000]78                                mov [output + ebx + 2], byte 'x'
   117 00000108 C683[74020000]74                                mov [output + ebx + 3], byte 't'
   118 0000010F C683[75020000]00                                mov [output + ebx + 4], byte 0
   119                                                          
   120                                                      nu_txt:
   121                                                      
   122                                                  nu_e_cuv_nou1:
   123                                                  
   124 00000116 80FE00                                  cmp dh, 0
   125 00000119 7507                                    jnz cuv_nou
   126 0000011B 8893[71020000]                              mov [output + ebx], dl
   127 00000121 43                                          inc ebx
   128                                                      
   129                                                  cuv_nou:
   130                                               
   131                                              par2:
   132                                                          
   133 00000122 46                                  inc esi
   134 00000123 E936FFFFFF                          jmp Repeta
   135                                              
   136                                      
   137                                      final:
   138                                      
   139 00000128 6A00                        push dword 0
   140 0000012A FF15[00000000]              call [exit]
   141                                      
